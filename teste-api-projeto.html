<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API - Dados do Projeto</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .loading {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .event-item {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
        }
        .event-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            vertical-align: middle;
        }
        .project-info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .timer-info {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Teste da API - Dados do Projeto</h1>
        <p>Esta p√°gina permite testar a nova API que busca dados espec√≠ficos de um projeto, incluindo o nome do projeto e as cores dos eventos.</p>
        
        <div class="input-group">
            <label for="projectCode">C√≥digo do Projeto:</label>
            <input type="text" id="projectCode" placeholder="Digite o c√≥digo do projeto (ex: ABC123)" value="">
        </div>
        
        <div class="input-group">
            <label for="apiUrl">URL da API:</label>
            <input type="text" id="apiUrl" placeholder="http://localhost:3001/api/supabase/project" value="http://localhost:3001/api/supabase/project">
        </div>
        
        <button onclick="buscarDados()" id="buscarBtn">Buscar Dados do Projeto</button>
        
        <div id="resultado"></div>
    </div>

    <script>
        async function buscarDados() {
            const projectCode = document.getElementById('projectCode').value.trim();
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const resultado = document.getElementById('resultado');
            const buscarBtn = document.getElementById('buscarBtn');
            
            if (!projectCode) {
                resultado.innerHTML = '<div class="result error">‚ùå Por favor, digite o c√≥digo do projeto.</div>';
                return;
            }
            
            if (!apiUrl) {
                resultado.innerHTML = '<div class="result error">‚ùå Por favor, digite a URL da API.</div>';
                return;
            }
            
            // Mostrar loading
            buscarBtn.disabled = true;
            buscarBtn.textContent = 'Buscando...';
            resultado.innerHTML = '<div class="result loading">üîÑ Buscando dados do projeto...</div>';
            
            try {
                const response = await fetch(`${apiUrl}/${projectCode}`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`Projeto n√£o encontrado: ${projectCode}`);
                    } else {
                        throw new Error(`Erro HTTP: ${response.status} - ${response.statusText}`);
                    }
                }
                
                const data = await response.json();
                exibirResultado(data.project);
                
            } catch (error) {
                resultado.innerHTML = `<div class="result error">‚ùå Erro: ${error.message}</div>`;
            } finally {
                buscarBtn.disabled = false;
                buscarBtn.textContent = 'Buscar Dados do Projeto';
            }
        }
        
        function exibirResultado(project) {
            let html = '<div class="result success">';
            html += '‚úÖ <strong>Dados carregados com sucesso!</strong>\n\n';
            
            // Informa√ß√µes do projeto
            html += '<div class="project-info">';
            html += '<h3>üìã Informa√ß√µes do Projeto</h3>';
            html += `<strong>C√≥digo:</strong> ${project.projectCode}<br>`;
            html += `<strong>Nome:</strong> ${project.projectName}<br>`;
            html += `<strong>√öltima Atualiza√ß√£o:</strong> ${new Date(project.lastUpdated).toLocaleString('pt-BR')}<br>`;
            html += `<strong>No Ar:</strong> ${project.onAir ? 'üü¢ Sim' : 'üî¥ N√£o'}`;
            html += '</div>';
            
            // Timer
            if (project.timer) {
                html += '<div class="timer-info">';
                html += '<h3>‚è±Ô∏è Timer</h3>';
                html += `<strong>Playback:</strong> ${project.timer.playback}<br>`;
                html += `<strong>Fase:</strong> ${project.timer.phase}<br>`;
                if (project.timer.current !== null) {
                    html += `<strong>Tempo Atual:</strong> ${project.timer.current}s<br>`;
                }
                if (project.timer.duration !== null) {
                    html += `<strong>Dura√ß√£o:</strong> ${project.timer.duration}s<br>`;
                }
                html += '</div>';
            }
            
            // Evento atual
            if (project.currentEvent) {
                html += '<div class="project-info">';
                html += '<h3>üé¨ Evento Atual</h3>';
                html += `<div class="event-color" style="background-color: ${project.currentEvent.colour}"></div>`;
                html += `<strong>Cue:</strong> ${project.currentEvent.cue}<br>`;
                html += `<strong>T√≠tulo:</strong> ${project.currentEvent.title}<br>`;
                html += `<strong>Cor:</strong> ${project.currentEvent.colour}<br>`;
                html += `<strong>Dura√ß√£o:</strong> ${project.currentEvent.duration}s<br>`;
                html += `<strong>P√∫blico:</strong> ${project.currentEvent.isPublic ? 'Sim' : 'N√£o'}`;
                if (project.currentEvent.note) {
                    html += `<br><strong>Nota:</strong> ${project.currentEvent.note}`;
                }
                html += '</div>';
            }
            
            // Pr√≥ximo evento
            if (project.nextEvent) {
                html += '<div class="project-info">';
                html += '<h3>‚è≠Ô∏è Pr√≥ximo Evento</h3>';
                html += `<div class="event-color" style="background-color: ${project.nextEvent.colour}"></div>`;
                html += `<strong>Cue:</strong> ${project.nextEvent.cue}<br>`;
                html += `<strong>T√≠tulo:</strong> ${project.nextEvent.title}<br>`;
                html += `<strong>Cor:</strong> ${project.nextEvent.colour}<br>`;
                html += `<strong>Dura√ß√£o:</strong> ${project.nextEvent.duration}s<br>`;
                html += `<strong>P√∫blico:</strong> ${project.nextEvent.isPublic ? 'Sim' : 'N√£o'}`;
                if (project.nextEvent.note) {
                    html += `<br><strong>Nota:</strong> ${project.nextEvent.note}`;
                }
                html += '</div>';
            }
            
            // Cuesheet
            html += '<div class="project-info">';
            html += '<h3>üìù Cuesheet Completo</h3>';
            html += `<strong>Total de Eventos:</strong> ${project.cuesheet.totalEvents}<br>`;
            html += `<strong>Dura√ß√£o Total:</strong> ${project.cuesheet.totalDuration}s<br><br>`;
            
            if (project.cuesheet.events && project.cuesheet.events.length > 0) {
                html += '<h4>üé≠ Lista de Eventos com Cores:</h4>';
                
                // Agrupar por cor
                const eventosPorCor = {};
                project.cuesheet.events.forEach(event => {
                    if (!eventosPorCor[event.colour]) {
                        eventosPorCor[event.colour] = [];
                    }
                    eventosPorCor[event.colour].push(event);
                });
                
                Object.keys(eventosPorCor).forEach(cor => {
                    html += `<h5 style="color: ${cor};">‚óè ${cor} (${eventosPorCor[cor].length} eventos)</h5>`;
                    eventosPorCor[cor].forEach((event, index) => {
                        html += '<div class="event-item">';
                        html += `<div class="event-color" style="background-color: ${event.colour}"></div>`;
                        html += `<strong>${index + 1}. [${event.cue}] ${event.title}</strong><br>`;
                        html += `Dura√ß√£o: ${event.duration}s | Tipo: ${event.type} | P√∫blico: ${event.isPublic ? 'Sim' : 'N√£o'}`;
                        if (event.note) {
                            html += `<br>Nota: ${event.note}`;
                        }
                        html += '</div>';
                    });
                });
                
                // Cores √∫nicas
                const coresUnicas = [...new Set(project.cuesheet.events.map(event => event.colour))];
                html += `<br><strong>Cores √∫nicas encontradas:</strong> ${coresUnicas.length}<br>`;
                coresUnicas.forEach(cor => {
                    html += `<span class="event-color" style="background-color: ${cor}" title="${cor}"></span>`;
                });
            } else {
                html += '<em>Nenhum evento encontrado no cuesheet.</em>';
            }
            
            html += '</div>';
            html += '</div>';
            
            resultado.innerHTML = html;
        }
        
        // Permitir busca com Enter
        document.getElementById('projectCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                buscarDados();
            }
        });
        
        document.getElementById('apiUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                buscarDados();
            }
        });
    </script>
</body>
</html>


